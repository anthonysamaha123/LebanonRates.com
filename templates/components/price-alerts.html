<!-- Price Alerts Component (Features 66-68) -->
<section class="section price-alerts">
  <h2>Price Alerts</h2>
  <p class="widget-description">Get notified when gold prices reach your target</p>
  
  <div class="alert-form-container">
    <form id="price-alert-form" class="alert-form">
      <div class="form-group">
        <label for="alert-karat">Watch Karat</label>
        <select name="karat" id="alert-karat" required>
          <option value="21k" selected>21K</option>
          <option value="18k">18K</option>
          <option value="24k">24K</option>
          <option value="14k">14K</option>
        </select>
      </div>
      <div class="form-group">
        <label for="alert-target">Target Price (USD per gram)</label>
        <input type="number" name="target" id="alert-target" step="0.01" min="0" placeholder="e.g. 130.00" required>
      </div>
      <div class="form-group">
        <label for="alert-email">Email</label>
        <input type="email" name="email" id="alert-email" placeholder="your@email.com" required>
      </div>
      <div class="form-group">
        <label for="alert-direction">Alert When</label>
        <select name="direction" id="alert-direction">
          <option value="above">Price goes above target</option>
          <option value="below">Price goes below target</option>
          <option value="either">Either direction</option>
        </select>
      </div>
      <button type="submit" class="btn">Set Alert</button>
    </form>
  </div>
  
  <div class="watch-button-container">
    <button type="button" id="watch-21k-btn" class="watch-btn">üëÅÔ∏è Watch 21K</button>
    <p class="watch-note">Adds 21K price to top of page (stored locally)</p>
  </div>
  
  <div class="telegram-link">
    <p>Or follow our Telegram channel for automatic price updates:</p>
    <a href="https://t.me/lebanonrates" class="telegram-channel-btn" target="_blank" rel="noopener">
      üì¢ Join Telegram Channel
    </a>
  </div>
</section>

<script>
// Watch 21K button (Feature 68)
(function() {
  const watchBtn = document.getElementById('watch-21k-btn');
  if (!watchBtn) return;
  
  // Check if already watching
  if (localStorage.getItem('watching21k') === 'true') {
    watchBtn.textContent = 'üëÅÔ∏è Watching 21K';
    watchBtn.classList.add('active');
  }
  
  watchBtn.addEventListener('click', function() {
    const isWatching = localStorage.getItem('watching21k') === 'true';
    if (isWatching) {
      localStorage.removeItem('watching21k');
      this.textContent = 'üëÅÔ∏è Watch 21K';
      this.classList.remove('active');
    } else {
      localStorage.setItem('watching21k', 'true');
      this.textContent = 'üëÅÔ∏è Watching 21K';
      this.classList.add('active');
      
      // Scroll to 21K price
      const price21k = document.querySelector('[data-karat="21k"]');
      if (price21k) {
        price21k.scrollIntoView({ behavior: 'smooth', block: 'center' });
        price21k.classList.add('highlighted');
        setTimeout(() => price21k.classList.remove('highlighted'), 2000);
      }
    }
  });
})();

// Price alert form (Feature 66)
(function() {
  const form = document.getElementById('price-alert-form');
  if (!form) return;
  
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    try {
      // In production, this would call a serverless function
      const response = await fetch('/api/price-alert', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      
      if (response.ok) {
        alert('Alert set! You will be notified when the price reaches your target.');
        form.reset();
      } else {
        alert('Failed to set alert. Please try again.');
      }
    } catch (error) {
      console.error('Alert error:', error);
      alert('Alert service is not available. Please check back later.');
    }
  });
})();
</script>
